<!DOCTYPE html>
<html>

<head>
  <title>HiveHelper</title>
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <style>
    .roster {
      border: 2px solid black;
      padding: 10px;
      margin-right: 10px;
      min-height: 200px;
      background-color: lightslategray;
    }

    .unit-card {
      border: 2px solid black;
      background-color: #f5f5f5;
      padding: 10px;
      margin-bottom: 10px;
      cursor: move;
    }

    .delete-button {
      cursor: pointer;
    }

    .export-container {
      padding: 10px;
      margin-bottom: 10px;
    }

    .export-textarea {
      width: 100%;
      height: 200px;
    }

    .close-button {
      cursor: pointer;
      color: black;
      font-size: large;
      float: left;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <h1>Hive Helper</h1>

  <div class="export-container" style="display: none;">
    <textarea id="exportTextarea" class="export-textarea" readonly></textarea>
    <span class="close-button" onclick="closeExportRoster()">X</span>
  </div>

  <button onclick="exportRoster()">Export Roster</button>
  <div class="roster" id="roster">
    <h2>Roster</h2>
  </div>

  <p id="totalPoints">Total Points: 0</p>

  <div>
    <label for="faction">Faction:</label>
    <select id="faction" onchange="filterUnitCards()">
      <option value=""></option>
      <!-- Add JavaScript code to populate the options -->
    </select>
  </div> <br>

  <div>
    <br><label for="filter">Filter:</label>
    <input type="text" id="filter" oninput="filterUnitCards()" placeholder="Enter a search term">
    <button onclick="clearFilterInput()">X</button>
  </div><br>

  <script>
const unitCards = [
  //ADEPTA SORORITAS
  {
    id: 'ADEPTA SORORITAS-unitCard1',
    name: 'Aestred Thurga and Agathae Dolan (2 models)',
    points: 70,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard2',
    name: 'Arco-flagellants (3 models)',
    points: 45,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard3',
    name: 'Arco-flagellants (10 models)',
    points: 150,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard4',
    name: 'Battle Sisters Squad (10 models)',
    points: 110,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard5',
    name: 'Canoness (1 model)',
    points: 60,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard6',
    name: 'Castigator (1 model)',
    points: 150,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard7',
    name: 'Celestian Sacresants (5 models)',
    points: 65,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard8',
    name: 'Celestian Sacresants (10 models)',
    points: 130,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard9',
    name: 'Crusaders (2 models)',
    points: 20,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard10',
    name: 'Crusaders (4 models)',
    points: 40,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard11',
    name: 'Crusaders (6 models)',
    points: 60,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard12',
    name: 'Daemonifuge (2 models)',
    points: 80,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard13',
    name: 'Death Cult Assassins (2 models)',
    points: 35,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard14',
    name: 'Death Cult Assassins (4 models)',
    points: 70,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard15',
    name: 'Death Cult Assassins (6 models)',
    points: 105,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard16',
    name: 'Dialogus (1 model)',
    points: 35,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard17',
    name: 'Dogmata (1 model)',
    points: 50,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard18',
    name: 'Dominion Squad (10 models)',
    points: 130,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard19',
    name: 'Exorcist (1 model)',
    points: 140,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard20',
    name: 'Hospitaller (1 model)',
    points: 40,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard21',
    name: 'Imagifier (1 model)',
    points: 40,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard22',
    name: 'Immolator (1 model)',
    points: 130,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard23',
    name: 'Junith Eruita (1 model)',
    points: 100,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard24',
    name: 'Missionary (1 model)',
    points: 35,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard25',
    name: 'Mortifiers (1 model)',
    points: 60,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard26',
    name: 'Mortifiers (2 models)',
    points: 120,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard27',
    name: 'Morvenn Vahl (1 model)',
    points: 135,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard28',
    name: 'Palatine (1 model)',
    points: 55,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard29',
    name: 'Paragon Warsuits (3 models)',
    points: 240,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard30',
    name: 'Penitent Engines (1 model)',
    points: 60,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard31',
    name: 'Penitent Engines (2 models)',
    points: 120,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard32',
    name: 'Preacher (1 model)',
    points: 45,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard33',
    name: 'Repentia Squad (5 models)',
    points: 75,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard34',
    name: 'Repentia Squad (10 models)',
    points: 150,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard35',
    name: 'Retributor Squad (5 models)',
    points: 130,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard36',
    name: 'Saint Celestine (3 models)',
    points: 150,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard37',
    name: 'Seraphim Squad (5 models)',
    points: 70,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard38',
    name: 'Seraphim Squad (10 models)',
    points: 140,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard39',
    name: 'Sisters Novitiate Squad (10 models)',
    points: 90,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard40',
    name: 'Sororitas Rhino (1 model)',
    points: 80,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard41',
    name: 'Triumph of Saint Katherine (1 model)',
    points: 150,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard42',
    name: 'Zephyrim Squad (5 models)',
    points: 70,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard43',
    name: 'Zephyrim Squad (10 models)',
    points: 140,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard44',
    name: 'Hallowed Martyrs - Blade of Saint Ellynor',
    points: 15,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard45',
    name: 'Hallowed Martyrs - Litanies of Faith',
    points: 25,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard46',
    name: 'Hallowed Martyrs - Mantle of Ophelia',
    points: 20,
    faction: 'ADEPTA SORORITAS'
  },
  {
    id: 'ADEPTA SORORITAS-unitCard47',
    name: 'Hallowed Martyrs - Saintly Example',
    points: 10,
    faction: 'ADEPTA SORORITAS'
  },

  

  





];


    function drag(event) {
      event.dataTransfer.setData("text/plain", event.target.id);
    }

    function drop(event) {
      event.preventDefault();
      const unitId = event.dataTransfer.getData("text/plain");
      addToRosterById(unitId);
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function addToRoster(name, points) {
      const roster = document.getElementById("roster");
      const unitCard = createUnitCard(name, points);
      const deleteButton = createDeleteButton(unitCard);
      unitCard.appendChild(deleteButton);
      roster.appendChild(unitCard);
      calculateTotalPoints();
      closeExportRoster();
    }

    function addToRosterById(unitId) {
      const unitCard = document.getElementById(unitId);
      const roster = document.getElementById("roster");
      const clonedCard = unitCard.cloneNode(true);
      clonedCard.removeAttribute("draggable");
      clonedCard.style.cursor = "default";
      const deleteButton = createDeleteButton(clonedCard);
      clonedCard.appendChild(deleteButton);
      roster.appendChild(clonedCard);
      calculateTotalPoints();
    }

    function createUnitCard(name, points, faction) {
      const unitCard = document.createElement("div");
      unitCard.className = "unit-card";
      unitCard.setAttribute("id", `unitCard${unitCards.length + 1}`);
      unitCard.setAttribute("draggable", "false");
      unitCard.setAttribute("ondragstart", "drag(event)");
      unitCard.setAttribute("data-name", name);
      unitCard.setAttribute("data-points", points);
      unitCard.setAttribute("data-faction", faction);

      const unitName = document.createElement("b");
      unitName.textContent = name + " - " + points + "pts";
      unitCard.appendChild(unitName);

      const addItemLink = document.createElement("a");
      addItemLink.href = "#";
      addItemLink.className = "add-link";
      addItemLink.textContent = " - ADD";
      addItemLink.onclick = function () {
        addToRoster(name, points);
      };
      unitCard.appendChild(addItemLink);

      return unitCard;
    }

    function createDeleteButton(unitCard) {
      const deleteButton = document.createElement("span");
      deleteButton.textContent = " - REMOVE";
      deleteButton.className = "delete-button";
      deleteButton.addEventListener("click", function () {
        unitCard.parentElement.removeChild(unitCard);
        closeExportRoster();
        calculateTotalPoints();
      });
      return deleteButton;
    }

    function calculateTotalPoints() {
      const roster = document.getElementById("roster");
      const unitCards = roster.getElementsByClassName("unit-card");
      let totalPoints = 0;
      for (let i = 0; i < unitCards.length; i++) {
        const points = parseInt(unitCards[i].getAttribute("data-points"));
        totalPoints += points;
      }
      document.getElementById("totalPoints").textContent = "Total Points: " + totalPoints;
    }

    function filterUnitCards() {
      const filterInput = document.getElementById("filter");
      const filterValue = filterInput.value.toLowerCase();
      const factionDropdown = document.getElementById("faction");
      const factionValue = factionDropdown.value.toLowerCase();
      const unitCards = document.getElementsByClassName("unit-card");

      // Clear the roster if the faction dropdown is changed to the default selection
      if (factionValue === "") {
        clearRoster();
        document.getElementById("totalPoints").textContent = "Total Points: 0"; // Reset the total points to 0
        closeExportRoster(); // Hide the export roster
        document.getElementById("exportTextarea").value = ""; // Reset the export roster text
        return;
      }

      for (let i = 0; i < unitCards.length; i++) {
        const unitCard = unitCards[i];
        const unitName = unitCard.getAttribute("data-name").toLowerCase();
        const unitFaction = unitCard.getAttribute("data-faction").toLowerCase();
        const inRoster = unitCard.parentElement.id === "roster";

        if (
          (unitName.includes(filterValue) || filterValue === "") &&
          (unitFaction === factionValue || factionValue === "") &&
          (factionValue !== "" || inRoster)
        ) {
          unitCard.style.display = "block";
        } else {
          unitCard.style.display = "none";
        }
      }

      // Show the selected units in the roster
      const selectedUnits = document.getElementById("roster").getElementsByClassName("unit-card");
      for (let i = 0; i < selectedUnits.length; i++) {
        selectedUnits[i].style.display = "block";
      }
    }

    function clearFilterInput() {
      const filterInput = document.getElementById("filter");
      filterInput.value = "";
      filterUnitCards();
    }

    function exportRoster() {
      const exportButton = document.querySelector("button[onclick='exportRoster()']");
      exportButton.style.display = "none";

      const roster = document.getElementById("roster");
      const unitCards = roster.getElementsByClassName("unit-card");
      let rosterText = "Roster Summary\n";
      let totalPoints = 0;

      for (let i = 0; i < unitCards.length; i++) {
        const unitCard = unitCards[i];
        const name = unitCard.getAttribute("data-name");
        const points = unitCard.getAttribute("data-points");
        rosterText += name + " - " + points + " pts" + "\n";
        totalPoints += parseInt(points);
      }

      const exportContainer = document.getElementsByClassName("export-container")[0];
      const exportTextarea = exportContainer.querySelector("#exportTextarea");
      exportTextarea.value = rosterText + "Total Points: " + totalPoints + " pts";
      exportContainer.style.display = "block";
    }

    function closeExportRoster() {
      const exportContainer = document.getElementsByClassName("export-container")[0];
      const exportButton = document.querySelector("button[onclick='exportRoster()']");
      exportContainer.style.display = "none";
      exportButton.style.display = "block";
    }

    function clearRoster() {
      const roster = document.getElementById("roster");
      roster.innerHTML = ""; // Clear the roster by removing all its child elements
      calculateTotalPoints();
    }

    const roster = document.getElementById("roster");
    roster.addEventListener("dragover", allowDrop);
    roster.addEventListener("drop", drop);

    // Set the default value for the faction selection
    document.getElementById("faction").value = ""; // Set the default value to 'SELECT'

    // Generate unit cards from the array
    for (let i = 0; i < unitCards.length; i++) {
      const unitCardData = unitCards[i];
      const unitCard = createUnitCard(unitCardData.name, unitCardData.points, unitCardData.faction);
      unitCard.setAttribute("id", unitCardData.id);
      document.body.insertBefore(unitCard, document.querySelector("script"));
    }

    const factionDropdown = document.getElementById("faction");
    const factions = Array.from(new Set(unitCards.map((card) => card.faction)));
    factionDropdown.innerHTML = factions
      .map((faction) => `<option value="${faction}">${faction}</option>`)
      .join("");
  </script>
</body>

</html>
